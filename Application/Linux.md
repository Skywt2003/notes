# Linux 学习笔记

[toc]

# 基本介绍

## Linux 和 Unix 的历史

### Unix 编年史

- **1969 年以前：受到启发。**Bell，MIT 与 GE 尝试开发「Multics」系统。
  - 由于经费不足，计划破产，但 Ken Thompson 受到启发。
- **1969 年：Unix 的原型诞生。**Ken Thompson 用汇编语言写出小型 file server system，是 Unix 的原型。
  - 提出两个核心思想：
    - 所有的程序或系统装置都是文件。
    - 不管建构编辑器还是附属文件，所写的程序只有一个目的，且要有效的完成目标。
- **1973 年：Unix 正式诞生。**Ritchie 等人以 C 语言写出第一个正式 Unix 核心。
  - 由于作为高级语言的 C 的可移植性，带来了 Unix 的可移植性。
- **1977 年：Unix 分支——BSD 诞生。**
  - 1973 年以后，Unix 得以与学术界合作开发。
  - 柏克莱（Berkeley）大学的 Bill Joy 在取得了 Unix 的核心原始码后，着手修改成适合自己机器的版本， 并且同时增加了很多工具软件与编译程序，最终将它命名为 **Berkeley Software Distribution（BSD）**。
- **1979 年：System V 架构与版权宣告。**
  - 每一家公司自己推出的 Unix 虽然在架构上大同小异，但是却仅能支持自身的硬件，所以早先的 Unix 只能用于服务器或大型工作站。直到 1979 年，AT&T 推出 **System V 第七版 Unix**，兼容个人计算机的 x86 架构。
  - 贝尔实验室隶属的 AT&T 由于商业的考虑，想将 Unix 的版权收回去。因此，AT&T 在 1979 年发行的第七版 Unix 中，特别提到了**「不可对学生提供源码」**的严格限制，也造成 Unix 业界之间的紧张气氛。
  - 目前被称为纯种的 Unix 指的就是 System V 以及 BSD。
- **1984 年之一：Minix 诞生。**
  - Andrew Tanenbaum 教授编写了 **Minix** 这个 Unix Like 的核心程序，支持 x86 架构，完全不参考 Unix 源码并且兼容 Unix。于 1986 年完成并于次年出版 Minix 相关书籍。通过磁盘售卖并附带源码。
- **1984 年之二：GNU 计划**与 **FSF 基金会的成立。**
  - Richard Mathew Stallman 在 1984 年发起 **GNU 计划**（GNU 其实是 GNU's Not Unix 的递归缩写）。这个计划的目的是：建立一个自由、开放的 Unix 操作系统（Free Unix）。Stallman 开始参考 Unix 上现有的软件，并在不参考源码的情况下依据这些软件的作用开发出功能相同的软件。逐渐打开了知名度。
  - 当时 C 语言编译程序版本众多，但都是专利软件。于是 Stallman 开始撰写 C 语言的编译程序  **GNU C Compiler（GCC）**。
  - Stallman 将他原先编写的 **Emacs 编辑器**移植到 Unix，并公布源码。出售磁带赚取经费。
  - Stallman 成立**自由软件基金会（Free Software Foundation，FSF）**，请更多工程师与志愿者撰写软件。1990 年左右，最终完成了 GCC 的编写。他还撰写了更多可以被调用的 C 函数库（GNU C library）以及可以被用来操作操作系统的基本接口 BASH shell。
  - 到了 1985 年，为了避免 GNU 所开发的自由软件被其他人所利用而成为专利软件，Stallman 与律师草拟了有名的**通用公共许可证（General Public License，GPL）**，并称呼它为 copyleft。
  - 由于当时并没有「自由的 Unix 核心」存在，这些软件仍只能在那些有专利的 Unix 平台上工作，直到 Linux 的出现。
- **1988 年：图形接口 XFree86 计划。**
  - 1984 年由 MIT 与其他第三方首次发表了 **X Window System**，并在 1988 年成立了非营利性质的 **XFree86 组织**。所谓的 XFree86 其实是 X Window System + Free + x86 的整合名称。

### 自由软件运动

- **自由软件运动。**Stallman 带领的将源代码连同软件程序发布的举动，称为**自由软件（Free Software）运动**。

- **GNU GPL（General Public License）：**为了避免自己的开发出来的自由软件被拿去做成专利软件，Stallman 同时将 GNU 与 FSF 发展出来的软件都挂上 GPL 的版权宣告。

- **自由软件的概念：**

  > "Free software" is a matter of liberty, not price. To understand the concept, you should think of "free speech", not "free beer". "Free software" refers to the users' freedom to run, copy, distribute, study, change, and improve the software 

- **自由软件与商业行为：**Linux 开发商大多是贩卖「售后服务」，其自由软件都可以在官网自由下载。GPL 并非意味着不能进行商业行为。

### Linux 的历史

Linux 的核心原型是 1991 年由托瓦兹（Linus Torvalds）写出来的。

- Torvalds 在 1988 年间进入了赫尔辛基大学，在大学期间接触了 Minix 系统。测试了 386 计算机的多任务性能。Tanenbaum 教授不愿加强 Minix 系统，于是 Torvalds 决定自己编写一个新的操作系统。GNU 计划提供的 bash 工作环境软件以及 gcc 编译程序等自由软件，让 Torvalds 得以顺利地撰写核心程序。

- **起源。**1991 年，一则 BBS 上的帖子：

  ```
  Hello everybody out there using minix- 
  I'm doing a (free) operation system (just a hobby, 
  won't be big and professional like gnu) for 386(486) AT clones. 
   
  I've currently ported bash (1.08) and gcc (1.40),  
  and things seem to work. This implies that i'll get  
  something practical within a few months, and I'd like to know  
  what features most people want. Any suggestions are welcome,  
  but I won't promise I'll implement them :-)  
  ```

  由于 Torvalds 放置核心的 FTP 网站的目录为 Linux，大家便称这个核心为 Linux 了。

- **Unix Like 操作系统。**为了兼容 Unix 的软件，Torvalds 开始参考标准的 POSIX（可携式操作系统接口，Portable Operating System Interface）规范。

- **模块化的架构。**志愿者加入开发，形成了 Linux 模块化的架构。Torvalds 测试志愿者开发的程序符合要求后就将其加入系统。后来则由 Alan Cox、Stephen Tweedie 等人负责测试。

- **吉祥物。**1994 年，这个虚拟的团队终于完成了 Linux 的核心正式版 version 1.0。1996 年完成了 2.0 版，选用了企鹅作为 Linux 的吉祥物。

- **全名？**由于 Linux 使用了很多的 GNU 相关软件，Stallman 认为 Linux 的全名应该称之为 GNU/Linux。

- **Linux 发行版。**为了让使用者能够接触到 Linux，很多商业公司或非营利团体将内核与可运行的软件整合起来，加上自己的工具程序（一般用于安装），这个「Kernel + Softwares + Tools」的整合就称为 Linux 发行版。

## Linux 基本概念的介绍

- Linux 是一种操作系统，其中的应用程序不算 Linux。
  - Linux 提供了一个完整的操作系统当中最底层的硬件控制与资源管理的完整架构， 这个架构是沿袭 Unix 良好的传统来的，所以相当稳定而功能强大。

### Linux 版本

```
2.6.18-92.el5
主版本.次版本.发布版本-修改版本
```

- **开发版（development）：**主、次版本为奇数，如 2.5.xx，这种核心版本主要用于测试与发展新功能，所以通常这种版本仅有核心开发工程师会使用。 如果有新增的核心程序代码，会加到这种版本当中，等到众多工程师测试没问题后，才加入下一版的稳定核心中。
- **稳定版（stable）：**主、次版本为偶数，如 2.6.xx，等到核心功能发展成熟后会加到这类的版本中，主要用在一般家庭计算机以及企业版本中。重点在于提供使用者一个相对稳定的 Linux 作业环境平台。
- **发布版（release）：**在主、次版本架构不变的情况下，新增的功能累积到一定的程度后新发布的核心版本。 由于 Linux 核心是使用 GPL 的授权，因此第三方能进行核心程序代码的修改，被修改过的新的核心版本就可以加上所谓的修改版本。
- **发行版（distribution）：**用户一般使用的是发行版而不是内核。

# 启动与关机

## 启动流程

### 内核引导（`/boot`）

### 运行 init（`/etc/inittab`）

根据不同场合的运行级别（runlevel）启动守护进程（daemon）

Linux 系统有 7 个运行级别：

- **运行级别 0：**系统停机状态。系统默认运行级别不能设为 0，否则不能正常启动。
- **运行级别 1：**单用户工作状态，root 权限，用于系统维护，禁止远程登陆。
- **运行级别 2：**多用户状态（没有 NFS）。
- **运行级别 3：**完全的多用户状态（有 NFS），登陆后进入控制台命令行模式。
- **运行级别 4：**系统未使用，保留。
- **运行级别 5：**X11 控制台，登陆后进入图形 GUI 模式。
- **运行级别 6：**系统正常关闭并重启。默认运行级别不能设为 6，否则不能正常启动

每个级别之前都会调用 `/etc/rc.d/rc.sysinit` 脚本执行系统初始化。

### 系统初始化

执行各种运行级别的 rc 脚本。

### 建立终端

rc 执行完毕后，返回 init。这时基本系统环境已经设置好了，各种守护进程也已经启动了。

init 接下来会打开 6 个终端，以便用户登录系统。

```shell
1:2345:respawn:/sbin/mingetty tty1
2:2345:respawn:/sbin/mingetty tty2
3:2345:respawn:/sbin/mingetty tty3
4:2345:respawn:/sbin/mingetty tty4
5:2345:respawn:/sbin/mingetty tty5
6:2345:respawn:/sbin/mingetty tty6
```

从上面可以看出在 2、3、4、5 的运行级别中都将以 respawn 方式运行 mingetty 程序，mingetty 程序能打开终端、设置模式。

同时它会显示一个文本登录界面，这个界面就是我们经常看到的登录界面，在这个登录界面中会提示用户输入用户名，而用户输入的用户将作为参数传给 login 程序来验证用户的身份。

### 用户登录系统

一般来说，用户的登录方式有三种：

1. 命令行登录

2. ssh登录

3. 图形界面登录

对于运行级别为 5 的图形方式用户来说，他们的登录是通过一个图形化的登录界面。登录成功后可以直接进入 KDE、Gnome 等窗口管理器。

而文本方式登录的情况：当我们看到 mingetty 的登录界面时，我们就可以输入用户名和密码来登录系统了。Linux 的账号验证程序是 login，login 会接收 mingetty 传来的用户名作为用户名参数，然后 login 会对用户名进行分析，

如果用户名不是 root，且存在 `/etc/nologin` 文件，login 将输出 nologin 文件的内容，然后退出。这通常用来系统维护时防止非 root 用户登录。

只有 `/etc/securetty` 中登记了的终端才允许 root 用户登录，如果不存在这个文件，则 root 用户可以在任何终端上登录。

`/etc/usertty` 文件用于对用户作出附加访问限制，如果不存在这个文件，则没有其他限制。

## 切换终端

Linux 预设提供了六个命令窗口终端机让我们来登录。默认我们登录的就是第一个窗口，也就是 tty1，这个六个窗口分别为 tty1，tty2，……，tty6，你可以按下 Ctrl + Alt + F1 ~ F6 来切换它们。

## 关机

正确的关机流程为：sync > shutdown > reboot > halt

关机指令为：shutdown ，你可以 man shutdown 来看一下帮助文档。

不管是重启系统还是关闭系统，首先要运行 sync 命令，把内存中的数据写到磁盘中。

关机的命令有 `shutdown –h now`，`halt`，`poweroff` 和 `init 0`

重启系统的命令有 `shutdown –r now`，`reboot`，`init 6`。

# 目录与文件

## 根目录下

- `/bin`：**Binaries（二进制文件）**。存放最经常使用的命令。

- `/boot`：**Boot（启动）**。存放启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。

- `/dev` ：**Device（设备）**。存放 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。

- `/etc`：**Etcetera（等等）**。存放所有的系统管理所需要的配置文件和子目录。

- `/home`：**Home（家）**。用户的主目录。一般目录名以用户名命名。

- `/lib`：**Library（库）**。存放系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。

- `/lost+found`：**Lost&Found（失物招领）**。一般情况下是空的。当系统非法关机后，这里就存放了一些文件。

- `/media`：**Media（媒体）**。Linux 系统会自动识别一些设备，例如 U 盘、光驱等等，当识别后，Linux 会把识别的设备挂载到这个目录下。

- `/mnt`：**Mount（挂载）**。系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 `/mnt/` 上，然后进入该目录就可以查看光驱里的内容了。

- `/opt`：**Optional（可选）**。这是给主机额外安装软件所摆放的目录。比如你安装一个 ORACLE 数据库则就可以放到这个目录下。默认是空的。

- `/proc`：**Processes（进程）**。`/proc` 是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件。这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。
  **这个目录的内容不在硬盘上而是在内存里，**我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的 ping 命令，使别人无法 ping 你的机器：

  ```shell
  echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
  ```

- `/root`：**Root（根）**。root 用户的用户主目录。

- `/sbin`：**Superuser Binaries（超级用户的二进制文件）**。root 用户使用的系统管理程序。

- `/selinux`：**Security Enhancement to Linux**。Redhat/CentOS 所特有的目录。Selinux 是一个非常复杂的安全机制，这个目录就是存放 Selinux 相关的文件的。

- `/srv`：**Service（服务）。**该目录存放一些服务启动之后需要提取的数据。

- `/sys`：**System（系统）。**该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。sysfs 文件系统集成了下面三种文件系统的信息：针对进程信息的 proc 文件系统，针对设备的 devfs 文件系统，以及针对伪终端的 devpts 文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。这是 Linux2.6 内核的一个很大的变化。

- `/tmp`：**Temporary（临时）**。用来存放一些临时文件。

- `/usr`：**Unix Shared Resources（共享资源）**，这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。

  - `/usr/bin`：系统用户使用的应用程序。
  - `/usr/sbin`：超级用户使用的比较高级的管理程序和系统守护程序。
  - `/usr/src`：内核源代码默认的放置目录。

- `/var`：**Variable（变量）**，存放在不断扩充着的东西。我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件（`/var/log` 目录下）。另外 mail 的预设放置也是在这里。

- `/run`：**Run（运行）。**是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 `/var/run` 目录，应该让它指向 `run`。

## 文件属性

在 Linux 中每个文件属性由一个长为 10 的字符串决定。

第一个字符代表这个文件是目录、文件或链接文件等等。

- 当为 `d` 则是目录；
- 当为 `-` 则是文件；
- 若是 `l` 则表示为链接文档（link file）；
- 若是 `b` 则表示为装置文件里面的可供储存的接口设备（可随机存取装置）；
- 若是 `c` 则表示为装置文件里面的串行端口设备，例如键盘、鼠标（一次性读取装置）。

接下来的字符中，以三个为一组，且均为 `rwx` 的三个参数的组合。其中，`r` 代表可读、`w` 代表可写、`x` 代表可执行（execute）。 如果没有权限，对应位置是减号 `-`。

第 0 位确定文件类型，第 1-3 位确定属主权限。第 4-6 位确定属组权限，第 7-9 位确定其他用户权限。

对于 root 用户来说，一般情况下，文件的权限对其不起作用。

## 更改文件属性

`-R` 表示递归修改文件夹。

### chgrp：更改文件属组

```shell
chgrp [-R] 属组名 文件名
```

### chown：更改文件属主，也可同时更改文件属组

```shell
chown [–R] 属主名 文件名
chown [-R] 属主名:属组名 文件名
```

### chmod：更改文件九个属性

用二进制 01 串来代表刚才的字符串，则对每个长度为 3 的 rwx 串，r=4，w=2，x=1。则将三个 rwx 串都转为一位十进制数字，得到三个数字 xyz。

```shell
 chmod [-R] xyz 文件或目录
```

也可以用符号的方式。没有上述方法方便。

```shell
chmod u/g/o/a +/-/= r/w/x 文件或目录
```

## 目录与文件管理

### mkdir：新建目录

- `-m`：配置文件的权限。

- `-p`：帮助你直接将所需要的目录（包含上一级目录）递归创建起来。

### cp：复制文件

- `-a`：相当于 `-pdr`。递归，连同属性。
- `-d`：若来源档为连结档的属性（link file），则复制连结档属性而非文件本身；
- `-f`：为强制（force）的意思，若目标文件已经存在且无法开启，则移除后再尝试一次；
- `-i`：若目标文件已存在，覆盖前询问。
- `-l`：进行硬式连结（hard link）的连结档创建，而非复制文件本身；
- `-p`：连同文件的属性一起复制，而非使用默认属性（备份常用）；
- `-r`：递归持续复制，用于目录的复制行为；
- `-s`：复制成为符号连结档（symbolic link），亦即“捷径”文件；
- `-u`：若 destination 比 source 旧才升级 destination。

### rm：删除文件

- `-f`：force，忽略不存在的文件，不会出现警告信息；
- `-i`：互动模式，在删除前会询问使用者是否动作；
- `-r`：递归删除。

### mv：移动文件

- `-f`：force，如果目标文件已经存在，不会询问而直接覆盖；
- `-i`：若目标文件（destination）已存在，询问是否覆盖；
- `-u`：若目标文件已经存在，且 source 比较新，才会升级（update）

## 查看内容

推荐用 `less`。

### cat 和 tac

cat：由第一行开始显示文件内容。

- `-A`：相当于 `-vET` 的整合选项，可列出一些特殊字符而不是空白；
- `-b`：列出行号。仅针对非空白行做行号显示，空白行不标行号；
- `-E`：将结尾的断行字节 `$` 显示出来；
- `-n`：列印出行号，连同空白行也会有行号，与 `-b` 的选项不同；
- `-T`：将 [tab] 按键以 `^I` 显示出来；
- `-v`：列出一些看不出来的特殊字符。

tac：从最后一行开始显示。参数同 cat。

### nl

显示的时候输出行号。

- `-b`：指定行号指定的方式，主要有两种：
  - `-b a`：表示不论是否为空行，也同样列出行号（类似 `cat -n`）；
  - `-b t`：如果有空行，空的那一行不要列出行号（默认值）；
- `-n`：列出行号表示的方法，主要有三种：
  - `-n ln`：行号在荧幕的最左方显示；
  - `-n rn`：行号在自己栏位的最右方显示，且不加 0 ；
  - `-n rz`：行号在自己栏位的最右方显示，且加 0 ；
- `-w`：行号栏位的占用的位数。

### more 和 less

more：一页一页地显示文件内容。

在 more 这个程序的运行过程中，你有几个按键可以按：

- 空白键（space）：向下翻一页；
- Enter：向下翻一行；
- `/字串`：代表在这个显示的内容当中，向下搜寻“字串”这个关键字；
- `:f`：立刻显示出档名以及目前显示的行数；
- `q`：代表立刻离开 more ，不再显示该文件内容。
- `b` 或 `[ctrl]-b`：代表往回翻页，不过这动作只对文件有用，对管线无用。

less：与 more 类似，可以往前翻页。

- 空白键；
- [pagedown]：向下翻动一页；
- [pageup] ：向上翻动一页；
- /字串
- ?字串：向上搜寻『字串』的功能；
- `n`：重复前一个搜寻 (与 / 或 ? 有关！)
- `N`：反向的重复前一个搜寻 (与 / 或 ? 有关！)
- `q`

### head 和 tail

head：只看头几行。

- `-n`：后面接数字，代表显示几行

tail：只看尾巴几行，

- `-n`：后面接数字，代表显示几行的意思
- `-f`：表示持续侦测后面所接的档名，要等到按下 [ctrl]-c 才会结束 tail 的侦测

# 用户和用户组

## 用户管理

### useradd：添加用户

```shell
useradd 选项 用户名
```

- `-c comment`：指定一段注释性描述。
- `-d 目录`：指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。
- `-g 用户组`：指定用户所属的用户组。
- `-G 用户组,用户组`：指定用户所属的附加组。
- `-s Shell文件`：指定用户的登录Shell。
- `-u 用户号`：指定用户的用户号。如果同时有 `-o` 选项，则可以重复使用其他用户的标识号。

### userdel：删除用户

```shell
userdel 选项 用户名
```

- `-r`：一同删除用户目录。

### usermod：修改账号属性

```shell
usermod 选项 用户名
```

选项和 `useradd` 命令一致。

### passwd：用户口令管理

用户账号刚创建时没有口令，但是被系统锁定，无法使用，必须为其指定口令后才可以使用，即使是指定空口令。

超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令。

```shell
passwd 选项 用户名
```

- `-l`：锁定口令，即禁用账号。
- `-u`：口令解锁。
- `-d`：使账号无口令。
- `-f`：强迫用户下次登录时修改口令。

## 用户组管理

组的增加、删除和修改实际上就是对/etc/group文件的更新。

### groupadd：添加组

- `-g GID`：指定新用户组的组标识号（GID）。
- `-o`：一般与 `-g` 选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同。

### groupdel：删除组

### groupmod：修改组属性

- `-g GID`
- `-o`
- `-n 新用户组`：将用户组的名字改为新名字

### newgrp：切换用户组

```shell
newgrp group
```

当前用户切换到 group 用户组。只能将主组切换到附加组。

## 相关文件

### /etc/passwd：用户信息

每个用户都在 `/etc/passwd` 文件中有一个对应的记录行，它记录了这个用户的一些基本属性。所有人可读。每行的格式：

```shell
用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell
```

#### 口令

虽然这个字段存放的只是用户口令的加密串，不是明文，但是由于 `/etc/passwd` 文件对所有用户都可读，所以这仍是一个安全隐患。因此，现在许多 Linux 系统（如 SVR4）都使用了 shadow 技术，把真正的加密后的用户口令字存放到 `/etc/shadow` 文件中，而在 `/etc/passwd` 文件的口令字段中只存放一个特殊的字符，例如 `x` 或者 `*`。

#### 用户标识号

通常用户标识号的取值范围是 0～65535。0 是超级用户 root 的标识号，1～99 由系统保留，作为管理账号，普通用户的标识号从 100 开始。在 Linux 系统中，这个界限是 500。

#### 登录 shell

Shell 是用户与 Linux 系统之间的接口。Linux 的 Shell 有许多种，每种都有不同的特点。常用的有 sh（Bourne Shell），csh（C Shell），ksh（Korn Shell），tcsh（TENEX/TOPS-20 type C Shell），bash（Bourne Again Shell）等。系统管理员可以根据系统情况和用户习惯为用户指定某个 Shell。如果不指定 Shell，那么系统使用 sh 为默认的登录 Shell，即这个字段的值为 `/bin/sh`。

用户的登录 Shell 也可以指定为某个特定的程序（此程序不是一个命令解释器）。利用这一特点，我们可以限制用户只能运行指定的应用程序，在该应用程序运行结束后，用户就自动退出了系统。有些 Linux 系统要求只有那些在系统中登记了的程序才能出现在这个字段中。

#### 伪用户

这些用户在 `/etc/passwd` 文件中也占有一条记录，但是不能登录，因为它们的登录 Shell 为空。它们的存在主要是方便系统管理，满足相应的系统进程对文件属主的要求。常见的伪用户如下所示：

```shell
bin 拥有可执行的用户命令文件 
sys 拥有系统文件 
adm 拥有帐户文件 
uucp UUCP 使用 
lp lp 或 lpd 子系统使用 
nobody NFS 使用
```

### /etc/shadow：用户口令信息

```
登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志
```

- 口令：加密后的用户口令字，长度为 13 个字符。如果为空，则对应用户没有口令，登录时不需要口令；如果含有不属于集合 `{ ./0-9A-Za-z }` 中的字符，则对应的用户不能登录。
- 最后一次修改时间：从某个时刻起，到用户最后一次修改口令时的天数。时间起点对不同的系统可能不一样。例如在 SCO Linux 中，这个时间起点是 1970年1月1日。
- 最小时间间隔：两次修改口令之间所需的最小天数。
- 最大时间间隔：口令保持有效的最大天数。
- 警告时间：从系统开始警告用户到用户密码正式失效之间的天数。
- 不活动时间：用户没有登录活动但账号仍能保持有效的最大天数。
- 失效时间：给出的是一个绝对的天数，如果使用了这个字段，那么就给出相应账号的生存期。期满后，该账号就不再是一个合法的账号，也就不能再用来登录了。

### /etc/group：用户组信息

```
组名:口令:组标识号:组内用户列表
```

- 组名：用户组的名称，由字母或数字构成。不应重复。
- 口令：用户组加密后的口令字。一般 Linux 系统的用户组都没有口令，即这个字段一般为空，或者是*。
- 组标识号：与用户标识号类似，也是一个整数，被系统内部用来标识组。
- 组内用户列表：属于这个组的所有用户的列表，不同用户之间用逗号(,)分隔。这个用户组可能是用户的主组，也可能是附加组。

## 批量添加用户

按照 passwd 文件的格式写一个 user.txt 并用 newusers 命令将其写入：

```shell
newusers < user.txt
```

暂时取消 shadow password 功能：

```shell
pwunconv
```

编辑用户和密码对照文件passwd.txt，每行格式为 `用户名:密码`。用 chpasswd 命令写入 passwd 文件：

```shell
chpasswd < passwd.txt
```

再启用 shadow passwd：

```shell
pwconv
```

# 磁盘管理

## df：列出文件系统的整体磁盘使用量

```shell
df [-ahikHTm] [目录或文件名]
```

- `-a`：列出所有的文件系统，包括系统特有的 `/proc` 等文件系统；
- `-k`：以 KBytes 的容量显示各文件系统；
- `-m`：以 MBytes 的容量显示各文件系统；
- `-h`：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示（常用）；
- `-H`：以 M=1000K 取代 M=1024K 的进位方式；
- `-T`：显示文件系统类型, 连同该 partition 的 filesystem 名称（例如 ext3）也列出；
- `-i`：不用硬盘容量，而以 inode 的数量来显示

## du：检查磁盘空间使用量

Linux du 命令也是查看使用空间的，但是与 df 命令不同的是 Linux du 命令是对文件和目录磁盘使用的空间的查看。

```shell
du [-ahskm] 文件或目录名称
```

- `-a`：列出所有的文件与目录容量，因为默认仅统计目录底下的文件量而已。
- `-h`
- `-s`：列出总量而已，而不列出每个各别的目录占用容量；
- `-S`：不包括子目录下的总计，与 `-s` 有点差别。
- `-k`
- `-m`

## fdisk：磁盘分区

```shell
fdisk [-l] 装置名称
```

- `-l`：输出后面接的装置所有的分区内容。若仅有 `fdisk -l` 时， 则系统将会把整个系统内能够搜寻到的装置的分区均列出来。

离开 fdisk 时按下 q，那么所有的动作都不会生效。相反的， 按下 w 就是动作生效的意思。

## mkfs：磁盘格式化

```shell
mkfs [-t 文件系统格式] 装置文件名
```

- `-t`：可以接文件系统格式，例如 ext3, ext2, vfat 等（系统有支持才会生效）

## fsck：磁盘检验（复杂）

fsck（file system check）用来检查和维护不一致的文件系统。若系统掉电或磁盘发生问题，可利用 fsck 命令对文件系统进行检查。

```
fsck [-t 文件系统] [-ACay] 装置名称
```

- -t : 给定档案系统的型式，若在 /etc/fstab 中已有定义或 kernel 本身已支援的则不需加上此参数
- -s : 依序一个一个地执行 fsck 的指令来检查
- -A : 对 /etc/fstab 中所有列出来的 分区（partition）做检查
- -C : 显示完整的检查进度
- -d : 打印出 e2fsck 的 debug 结果
- -p : 同时有 -A 条件时，同时有多个 fsck 的检查一起执行
- -R : 同时有 -A 条件时，省略 / 不检查
- -V : 详细显示模式
- -a : 如果检查有错则自动修复
- -r : 如果检查有错则由使用者回答是否修复
- -y : 选项指定检测每个文件是自动输入 yes，在不确定那些是不正常的时候，可以执行 # fsck -y 全部检查修复。

## mount/umount：磁盘挂载与卸除

```
mount [-t 文件系统] [-L Label名] [-o 额外选项] [-n]  装置文件名  挂载点
umount [-fn] 装置文件名或挂载点
```

- -f：强制卸除！可用在类似网络文件系统（NFS）无法读取到的情况下；
- -n：不升级 /etc/mtab 情况下卸除。


