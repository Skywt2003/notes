# Crontab 基本用法

[toc]

Crontab 用于定期执行命令。

## 基本概念

- 对于每个用户，可以用 crontab 设定一个时程表。

- 时程表是一个文本文件，每一行是一个定期执行的任务。

## 命令

```shell
crontab [ -u user ] { -l | -r | -e }
```

`-u user` 是指定 user 的时程表，必须要有权限。如不使用则表示设定自己的时程表。 

- `-e`：编辑时程表
- `-r`：删除时程表
- `-l`：列出时程表

```shell
crontab file
```

将 file 文件作为时程表。

## 语法

```shell
f1 f2 f3 f4 f5 program
```

- f1 表示分钟（0～59，分钟是最小单位），f2 表示小时（0～23），f3 表示日（1～31），f4 表示月（1～12），f5 表示星期几（0～6，星期天为 0）。program 表示要执行的程序。
- 以分钟为例，`*`  表示每分钟，`a-b` 表示 a 到 b 分钟，`f1/n` 表示每 n 分钟（可以与前组合使用，如 `a-b/n`、`*/n`），`a,b,c,...` 表示每小时的第 a，b，c，……分钟。

## 注意事项

- **延迟开始：** 新创建的任务最多 2 分钟后才会开始执行，重启 cron 可以使之马上执行。

- **邮件通知：** 每次执行后，系统会发一封系统邮件给当前的用户，显示该程序执行的内容，在命令末尾加上 `> /dev/null 2>&1` 可以避免，如：

  ```
  20 03 * * * . /etc/profile;/bin/sh /var/www/runoob/test.sh > /dev/null 2>&1 
  ```

- **绝对路径：** 所有路径需要写成绝对路径形式。

- **环境变量：** 可能无法读取环境变量。解决办法：在 shell 脚本开头使用以下代码：

  ```
  #!/bin/sh
  . /etc/profile
  . ~/.bash_profile
  ```

  在 `/etc/crontab` 中添加环境变量，在可执行命令之前添加命令 `. /etc/profile;/bin/sh`，使得环境变量生效，例如：

  ```
  20 03 * * * . /etc/profile;/bin/sh /var/www/runoob/test.sh
  ```

